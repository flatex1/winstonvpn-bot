import { Composer } from "grammy";
import { createLogger } from "../../utils/logger";
import { instructionsKeyboard, mainKeyboard } from "../keyboards";

const logger = createLogger("command:instructions");

const composer = new Composer();

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "üì± –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è"
composer.hears("üì± –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è", async (ctx) => {
  try {
    await ctx.reply(
      "–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à—É –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—é:",
      {
        reply_markup: instructionsKeyboard,
      }
    );
  } catch (error) {
    logger.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∫–∞–∑–µ –º–µ–Ω—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π", error);
    await ctx.reply("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.");
  }
});

// –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è Windows
composer.callbackQuery("instruction_windows", async (ctx) => {
  try {
    await ctx.editMessageText(
      `*–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—é –Ω–∞ Windows*

1. –°–∫–∞—á–∞–π—Ç–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ NekoBox –¥–ª—è Windows:
   ‚Ä¢ [–°–∫–∞—á–∞—Ç—å NekoBox](https://github.com/MatsuriDayo/nekoray/releases)
   ‚Ä¢ –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª \`nekobox-\*-windows64.zip\`

2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:
   ‚Ä¢ –í –±–æ—Ç–µ –Ω–∞–∂–º–∏—Ç–µ "üîë –î–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è" –∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
   ‚Ä¢ –û—Ç–∫—Ä–æ–π—Ç–µ NekoBox
   ‚Ä¢ –ù–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–≥—Ä–∞–º–º–∞" –≤ –≤–µ—Ä—Ö–Ω–µ–º –º–µ–Ω—é
   ‚Ä¢ –í—ã–±–µ—Ä–∏—Ç–µ "–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –∏–∑ –±—É—Ñ–µ—Ä–∞ –æ–±–º–µ–Ω–∞"

3. –ó–∞–ø—É—Å–∫ VPN:
   ‚Ä¢ –í—ã–±–µ—Ä–∏—Ç–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å –≤ —Å–ø–∏—Å–∫–µ (–ü–ö–ú -> –ó–∞–ø—É—Å—Ç–∏—Ç—å)
   ‚Ä¢ –ü–æ—Å—Ç–∞–≤—å—Ç–µ –≥–∞–ª–æ—á–∫—É –≤ —á–µ–∫–±–æ–∫—Å–µ "–†–µ–∂–∏–º TUN"
   ‚Ä¢ –†–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ç–∏, –µ—Å–ª–∏ Windows –∑–∞–ø—Ä–æ—Å–∏—Ç

*–ì–æ—Ç–æ–≤–æ!* –í–∞—à–µ VPN-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ.

üí° *–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ*: –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤. –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –ø—Ä–æ–≥—Ä–∞–º–º—ã.`,
      {
        parse_mode: "Markdown",
        reply_markup: instructionsKeyboard,
      }
    );
  } catch (error) {
    logger.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∫–∞–∑–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è Windows", error);
    await ctx.answerCallbackQuery("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.");
  }
});

// –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è Android
composer.callbackQuery("instruction_android", async (ctx) => {
  try {
    await ctx.editMessageText(
      `*–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—é –Ω–∞ Android*

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ V2rayNG –∏–∑ Google Play Store
2. –û—Ç–∫—Ä–æ–π—Ç–µ –±–æ—Ç–∞ –∏ –Ω–∞–∂–º–∏—Ç–µ "üîë –î–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è"
3. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å" –ø–æ–¥ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
4. –û—Ç–∫—Ä–æ–π—Ç–µ V2rayNG –∏ –Ω–∞–∂–º–∏—Ç–µ + -> –ò–º–ø–æ—Ä—Ç –∏–∑ –±—É—Ñ–µ—Ä–∞ –æ–±–º–µ–Ω–∞
5. –í—ã–±–µ—Ä–∏—Ç–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä
6. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (–∫—Ä—É–≥ –≤–Ω–∏–∑—É —ç–∫—Ä–∞–Ω–∞)

*–ì–æ—Ç–æ–≤–æ!* –í–∞—à–µ VPN-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ.`,
      {
        parse_mode: "Markdown",
        reply_markup: instructionsKeyboard,
      }
    );
  } catch (error) {
    logger.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∫–∞–∑–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è Android", error);
    await ctx.answerCallbackQuery("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.");
  }
});

// –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è iOS
composer.callbackQuery("instruction_ios", async (ctx) => {
  try {
    await ctx.editMessageText(
      `*–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—é –Ω–∞ iOS*

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ Happ –∏–∑ App Store
2. –û—Ç–∫—Ä–æ–π—Ç–µ –±–æ—Ç–∞ –∏ –Ω–∞–∂–º–∏—Ç–µ "üîë –î–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è"
3. C–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ "+ -> –í—Å—Ç–∞–≤–∏—Ç—å –∏–∑ –±—É—Ñ–µ—Ä–∞ –æ–±–º–µ–Ω–∞"
4. –í –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ Happ –≤—ã–±–µ—Ä–∏—Ç–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä
5. –í–∫–ª—é—á–∏—Ç–µ VPN –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–µ–º –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

*–ì–æ—Ç–æ–≤–æ!* –í–∞—à–µ VPN-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ.`,
      {
        parse_mode: "Markdown",
        reply_markup: instructionsKeyboard,
      }
    );
  } catch (error) {
    logger.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∫–∞–∑–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è iOS", error);
    await ctx.answerCallbackQuery("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.");
  }
});

// –í–æ–∑–≤—Ä–∞—Ç –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
composer.callbackQuery("back_to_menu", async (ctx) => {
  try {
    await ctx.answerCallbackQuery();
    await ctx.deleteMessage();
    
    await ctx.reply(
      "–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é:",
      {
        reply_markup: mainKeyboard,
      }
    );
  } catch (error) {
    logger.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", error);
    await ctx.answerCallbackQuery({
      text: "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.",
      show_alert: true,
    });
  }
});

export default composer; 